---
- name: Create ~/.ssh/config.d
  file:
    path: ~/.ssh/config.d
    owner: '{{ ansible_user }}'
    state: directory
  when: ansible_os_family != 'Windows'
- name: Create ~/.ssh/config.d on Windows
  win_file:
    path: ~/.ssh/config.d
    owner: '{{ ansible_user }}'
    state: directory
  when: ansible_os_family == 'Windows'
- name: Include ~/.ssh/config.d in main config file
  lineinfile:
    path: ~/.ssh/config
    regexp: 'Include (~.ssh/)?config.d/\*'
    line: Include ~/.ssh/config.d/*
    insertbefore: BOF
    create: yes
  when: ansible_os_family != 'Windows'
- name: Include ~/.ssh/config.d in main config file
  lineinfile:
    path: ~/.ssh/config
    regexp: 'Include (~.ssh/)?config.d/\*'
    line: Include ~/.ssh/config.d/*
    insertbefore: BOF
    create: yes
  when: ansible_os_family == 'Windows'
- name: Create config file for local network
  copy:
    src: local
    dest: ~/.ssh/config.d/local
    force: yes
